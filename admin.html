<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Decisive's Blog - 后台管理</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/mdui@1.0.1/dist/css/mdui.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.1/build/styles/vs.min.css"/>
    <link rel="stylesheet" href="css/highlight-vs2015-style.css"/>
    <link rel="stylesheet" href="css/style.css"/>
</head>

<body class="mdui-drawer-body-left mdui-appbar-with-toolbar mdui-theme-primary-indigo mdui-theme-accent-pink mdui-theme-layout-auto">

<header class="mdui-appbar mdui-appbar-fixed">
    <div class="mdui-toolbar mdui-color-theme">
        <span class="mdui-btn mdui-btn-icon mdui-ripple mdui-ripple-white"
              mdui-drawer="{target: '#main-drawer', swipe: true}"><i class="mdui-icon material-icons">menu</i></span>
        <a href="/" class="mdui-typo-headline mdui-hidden-xs">Decisive 's Blog</a>
        <div class="mdui-toolbar-spacer"></div>
        <span class="mdui-btn mdui-btn-icon mdui-ripple mdui-ripple-white" mdui-dialog="{target: '#dialog-theme'}"
              mdui-tooltip="{content: '设置主题'}"><i class="mdui-icon material-icons">color_lens</i></span>
        <span class="mdui-btn mdui-btn-icon mdui-ripple mdui-ripple-white" onclick="logout();"
              mdui-tooltip="{content: '注销登录'}"><i class="mdui-icon material-icons">account_circle</i></span>
    </div>
</header>

<div class="mdui-drawer" id="main-drawer" open.mdui.collapse>
    <div class="mdui-list" mdui-collapse="{accordion: true}" style="margin-bottom: 76px;">
        <div class="mdui-collapse-item">
            <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
                <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-blue">near_me</i>
                <div class="mdui-list-item-content">博客</div>
                <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
            </div>
            <div class="mdui-collapse-item-body mdui-list">
                <a href="/" class="mdui-list-item mdui-ripple ">主页</a>
                <a href="" class="mdui-list-item mdui-ripple ">归档</a>
                <a href="" class="mdui-list-item mdui-ripple ">标签</a>
            </div>
        </div>
        <div class="mdui-collapse-item ">
            <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
                <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-green">widgets</i>
                <div class="mdui-list-item-content">目录</div>
                <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
            </div>
            <div class="mdui-collapse-item-body mdui-list" id="indexes" v-html="indexes">
                {{ indexes }}
            </div>
        </div>
        <div class="mdui-collapse-item ">
            <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
                <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-brown">view_carousel</i>
                <div class="mdui-list-item-content">友链</div>
                <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
            </div>
            <div class="mdui-collapse-item-body mdui-list" id="links" v-html="links">
                {{ links }}
            </div>
        </div>
        <div class="mdui-collapse-item ">
            <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
                <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-purple">local_mall</i>
                <div class="mdui-list-item-content">关于</div>
                <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
            </div>
            <div class="mdui-collapse-item-body mdui-list">
                <a href="" class="mdui-list-item mdui-ripple ">关于本站</a>
                <a href="" class="mdui-list-item mdui-ripple ">关于我</a>
            </div>
        </div>
    </div>
</div>
<a id="anchor-top"></a>

<div id="drawing_progress" class="mdui-progress">
    <div class="mdui-progress-indeterminate"></div>
</div>
<div class="mdui-container doc-container">

    <h1 class="doc-title mdui-text-color-theme">后台管理</h1>
    <div class="mdui-divider"></div>
    <div class="mdui-row">
        <div class="mdui-col-md-6 mdui-col-offset-md-3">
            <h2 class="doc-title mdui-text-color-theme">文章管理</h2>
            <div class="mdui-panel" mdui-panel id="pages">
                <div class="mdui-panel-item">
                    <div class="mdui-panel-item-header">
                        <div class="mdui-panel-item-title">添加新文章</div>
                        <div class="mdui-panel-item-summary"></div>
                        <i class="mdui-panel-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
                    </div>
                    <div class="mdui-panel-item-body">
                        <div class="mdui-panel-item-actions">
                            <button class="mdui-btn mdui-ripple" mdui-panel-item-close>取消</button>
                            <button class="mdui-btn mdui-ripple" onclick="window.location.href='add_page.html'">添加
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br><br>
    <div class="mdui-row">
        <div class="mdui-col-md-6 mdui-col-offset-md-3">
            <h2 class="doc-title mdui-text-color-theme">目录</h2>
            <p style="display: none" id="index_count">0</p>
            <div class="mdui-panel" id="admin_indexes" mdui-panel>
                <div class="mdui-panel-item">
                    <div class="mdui-panel-item-header">
                        <div class="mdui-panel-item-title">添加目录</div>
                        <div class="mdui-panel-item-summary"></div>
                        <i class="mdui-panel-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
                    </div>
                    <div class="mdui-panel-item-body">
                        <div class="mdui-textfield">
                            <label>
                                <input id="add_index" class="mdui-textfield-input" type="text" placeholder="目录名"/>
                            </label>
                        </div>
                        <div class="mdui-panel-item-actions">
                            <button id="button_cancel_add_index" class="mdui-btn mdui-ripple" mdui-panel-item-close>取消
                            </button>
                            <button id="button_add_index" onclick="add_index();" class="mdui-btn mdui-ripple">添加
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br><br>
    <div class="mdui-row">
        <div class="mdui-col-md-6 mdui-col-offset-md-3">
            <h2 class="doc-title mdui-text-color-theme">友链</h2>
            <p style="display: none" id="links_count">0</p>
            <div class="mdui-panel" id="admin_links" mdui-panel>
                <div class="mdui-panel-item">
                    <div class="mdui-panel-item-header">
                        <div class="mdui-panel-item-title">添加友链</div>
                        <div class="mdui-panel-item-summary"></div>
                        <i class="mdui-panel-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
                    </div>
                    <div class="mdui-panel-item-body">
                        <div class="mdui-textfield">
                            <label>
                                <input id="add_link_title" class="mdui-textfield-input" type="text" placeholder="标题"/>
                            </label><br>
                            <label>
                                <input id="add_link" class="mdui-textfield-input" type="text" placeholder="域名"/>
                            </label>
                        </div>
                        <div class="mdui-panel-item-actions">
                            <button id="button_cancel_add_link" class="mdui-btn mdui-ripple" mdui-panel-item-close>取消
                            </button>
                            <button id="button_add_link" onclick="add_link();" class="mdui-btn mdui-ripple">添加</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.js"></script>
<script src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.polyfills.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/holderjs@2.9.7/holder.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.1/build/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mdui@1.0.1/dist/js/mdui.min.js"></script>
<script src="js/contents.js"></script>
<script>
    let draw_control = 0;
    $.ajax({
        url: "api.php",
        type: "post",
        dataType: "json",
        async: false,
        data: {
            'function': 'login_check',
        },
        success: function (result) {
            if (result.data.isSucceed === 'false') {
                window.location.href = "admin_login.html";
            }

        },
        error: function () {
            console.log("API Called Faultily")
        }
    })

    const links = new Vue({
        el: '#links',
        data: {
            links: ''
        }
    });

    const indexes = new Vue({
        el: '#indexes',
        data: {
            indexes: ''
        }
    });

    $.ajax({
        url: "api.php",
        type: "post",
        dataType: "json",
        data: {
            'function': 'draw_slider',
        },
        success: function (result) {
            for (i = 0; i < result.data.count_links; i++) {
                links.$data.links += '<a target="_blank" href="' + result.data.links[i].Link + '" class="mdui-list-item mdui-ripple ">' + result.data.links[i].LinkTitle + '</a>';
            }
            for (i = 0; i < result.data.count_indexes; i++) {
                indexes.$data.indexes += '<a href="page_index.html?index=' + result.data.indexes[i].IndexName + '" class="mdui-list-item mdui-ripple ">' + result.data.indexes[i].IndexName + '</a>';
            }

            let admin_links = document.getElementById("admin_links");
            let links_count = $("#links_count")
            for (i = 0; i < result.data.count_links; i++) {
                links_count.text(i + 1)
                admin_links.innerHTML +=
                    '<div id="link_item' + i + '" class="mdui-panel-item">' +
                    '                    <div class="mdui-panel-item-header">' +
                    '                        <div id="link_title_old' + i + '" class="mdui-panel-item-title">' + result.data.links[i].LinkTitle + '</div>' +
                    '                        <div id="link_old' + i + '" class="mdui-panel-item-summary">' + result.data.links[i].Link + '</div>' +
                    '                        <i class="mdui-panel-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>' +
                    '                    </div>' +
                    '                    <div class="mdui-panel-item-body">' +
                    '                        <div class="mdui-textfield">' +
                    '                          <label>' +
                    '                                <input id="link_title' + i + '" class="mdui-textfield-input" type="text" value="' + result.data.links[i].LinkTitle + '"/>' +
                    '                            </label><br>' +
                    '                            <label>' +
                    '                                <input id="link' + i + '" class="mdui-textfield-input" type="text" value="' + result.data.links[i].Link + '"/>' +
                    '                            </label>' +
                    '                        </div>' +
                    '                        <div class="mdui-panel-item-actions">' +
                    '                            <button class="mdui-btn mdui-ripple" mdui-panel-item-close>取消</button>' +
                    '                            <button class="mdui-btn mdui-ripple" onclick="delete_link(' + i + ')" mdui-panel>删除</button>' +
                    '                            <button class="mdui-btn mdui-ripple" onclick="update_link(' + i + ')">修改</button>' +
                    '                        </div>' +
                    '                    </div>' +
                    '                </div>';
            }

            let admin_indexes = document.getElementById("admin_indexes");
            let indexes_count = $("#indexes_count")
            for (i = 0; i < result.data.count_indexes; i++) {
                indexes_count.text(i + 1)
                admin_indexes.innerHTML +=
                    '<div id="index_item' + i + '" class="mdui-panel-item">' +
                    '                    <div class="mdui-panel-item-header">' +
                    '                        <div id="index_title_old' + i + '" class="mdui-panel-item-title">' + result.data.indexes[i].IndexName + '</div>' +
                    '                        <i class="mdui-panel-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>' +
                    '                    </div>' +
                    '                    <div class="mdui-panel-item-body">' +
                    '                        <div class="mdui-textfield">' +
                    '                          <label>' +
                    '                                <input id="index_title' + i + '" class="mdui-textfield-input" type="text" value="' + result.data.indexes[i].IndexName + '"/>' +
                    '                            </label><br>' +
                    '                        </div>' +
                    '                        <div class="mdui-panel-item-actions">' +
                    '                            <button class="mdui-btn mdui-ripple" mdui-panel-item-close>取消</button>' +
                    '                            <button class="mdui-btn mdui-ripple" onclick="delete_index(' + i + ')" mdui-panel>删除</button>' +
                    '                            <button class="mdui-btn mdui-ripple" onclick="update_index(' + i + ')">修改</button>' +
                    '                        </div>' +
                    '                    </div>' +
                    '                </div>';
                draw_control++;
                if (draw_control === 2)
                    $('#drawing_progress').hide()
            }
        },
        error: function () {
            draw_control++;
            if (draw_control === 2)
                $('#drawing_progress').hide()
            console.log("Standard API Called Faultily");
        }
    });
    $.ajax({
        url: "api.php",
        type: "post",
        dataType: "json",
        data: {
            'function': 'draw_admin_pages',
        },
        success: function (result) {

        },
        error: function () {

        }
    })

    /*<div class="mdui-panel-item">
                        <div class="mdui-panel-item-header">
                            <div class="mdui-panel-item-title">添加新文章</div>
                            <div class="mdui-panel-item-summary"></div>
                            <i class="mdui-panel-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
                        </div>
                        <div class="mdui-panel-item-body">
                            <div class="mdui-panel-item-actions">
                                <button class="mdui-btn mdui-ripple" mdui-panel-item-close>取消</button>
                                <button class="mdui-btn mdui-ripple" onclick="window.location.href='add_page.html'">添加</button>
                            </div>
                        </div>
                    </div>*/

    function update_link(i) {
        let link_title_old = $("#link_title_old" + i)
        let link_old = $("#link_old" + i)
        let link_title = $("#link_title" + i)
        let link = $("#link" + i)
        if (link_title.val() === "" || link.val() === '') {
            mdui.alert("请输入内容", "警告")
            return
        }

        $.ajax({
            url: "api.php",
            type: "post",
            dataType: "json",
            data: {
                'function': 'update_link',
                'link_title_old': link_title_old.text(),
                'link_title': link_title.val(),
                'link': link.val()
            },
            success: function (result) {
                if (result.data.isSucceed === 'false')
                    mdui.alert("您未登录", "警告")
                if (result.data.isSucceed === 'true') {
                    mdui.alert("修改成功", "提醒")
                    link_old.text(link.val())
                    link_title_old.text(link_title.val())
                }
            },
            error: function () {
                mdui.alert("未知错误", "提醒")
            }
        })
    }

    function add_link() {
        let link_title = $("#add_link_title")
        let link = $("#add_link")
        if (link_title.val() === '' || link.val() === '') {
            mdui.alert("请输入内容", "警告")
            return
        }
        $.ajax({
            url: "api.php",
            type: "post",
            dataType: "json",
            data: {
                'function': "add_link",
                'link_title': link_title.val(),
                'link': link.val()
            },
            success: function (result) {
                if (result.data.isSucceed === false)
                    mdui.alert(result.data.error_message, "警告")
                if (result.data.isSucceed === 'true') {
                    mdui.alert("添加成功", "提醒")
                    let admin_links = document.getElementById("admin_links");
                    let i = $("#links_count").text()
                    admin_links.innerHTML +=
                        '<div id="link_item' + i + '" class="mdui-panel-item">' +
                        '                    <div class="mdui-panel-item-header">' +
                        '                        <div id="link_title_old' + i + '" class="mdui-panel-item-title">' + link_title.val() + '</div>' +
                        '                        <div id="link_old' + i + '" class="mdui-panel-item-summary">' + link.val() + '</div>' +
                        '                        <i class="mdui-panel-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>' +
                        '                    </div>' +
                        '                    <div class="mdui-panel-item-body">' +
                        '                        <div class="mdui-textfield">' +
                        '                          <label>' +
                        '                                <input id="link_title' + i + '" class="mdui-textfield-input" type="text" value="' + link_title.val() + '"/>' +
                        '                            </label><br>' +
                        '                            <label>' +
                        '                                <input id="link' + i + '" class="mdui-textfield-input" type="text" value="' + link.val() + '"/>' +
                        '                            </label>' +
                        '                        </div>' +
                        '                        <div class="mdui-panel-item-actions">' +

                        '                            <button class="mdui-btn mdui-ripple" mdui-panel-item-close>取消</button>' +
                        '                            <button class="mdui-btn mdui-ripple" onclick="delete_link(' + i + ')" mdui-panel>删除</button>' +
                        '                            <button class="mdui-btn mdui-ripple" onclick="update_link(' + i + ')">修改</button>' +
                        '                        </div>' +
                        '                    </div>' +
                        '                </div>';
                    link_title.val("")
                    link.val("")
                    $("#button_cancel_add_link").click()
                }
            },
            error: function () {
                mdui.alert("未知错误", "提醒")
            }
        })
    }

    function delete_link(i) {
        let link_title = $("#link_title_old" + i)
        mdui.confirm('是否确认删除？', '提醒', function () {
            $.ajax({
                url: "api.php",
                type: "post",
                dataType: "json",
                data: {
                    'function': 'delete_link',
                    'link_title': link_title.text()
                },
                success: function (result) {
                    if (result.data.isSucceed === 'true') {
                        var obj = document.getElementById("link_item" + i);
                        obj.innerHTML = "";
                        var parentObj = obj.parentNode;
                        parentObj.removeChild(obj);
                    } else {
                        mdui.alert("您未登录", "警告")
                    }
                },
                error: function () {
                    mdui.alert("未知错误", "提醒")
                }
            })
        });
    }

    function update_index(i) {
        let index_title_old = $("#index_title_old" + i)
        let index_title = $("#index_title" + i)
        if (index_title.val() === "") {
            mdui.alert("请输入内容", "警告")
            return
        }

        $.ajax({
            url: "api.php",
            type: "post",
            dataType: "json",
            data: {
                'function': 'update_index',
                'index_title_old': index_title_old.text(),
                'index_title': index_title.val(),
            },
            success: function (result) {
                if (result.data.isSucceed === 'false')
                    mdui.alert("您未登录", "警告")
                if (result.data.isSucceed === 'true') {
                    mdui.alert("修改成功", "提醒")
                    index_title.text(link.val())
                    index_title_old.text(link_title.val())
                }
            },
            error: function () {
                mdui.alert("未知错误", "提醒")
            }
        })
    }

    function add_index() {
        let index_name = $("#add_index")
        if (index_name.val() === '') {
            mdui.alert("请输入内容", "警告")
            return
        }
        $.ajax({
            url: "api.php",
            type: "post",
            dataType: "json",
            data: {
                'function': "add_index",
                'index_name': index_name.val(),
            },
            success: function (result) {
                if (result.data.isSucceed === false)
                    mdui.alert(result.data.error_message, "警告")
                if (result.data.isSucceed === 'true') {
                    mdui.alert("添加成功", "提醒")
                    let admin_index = document.getElementById("admin_indexes");
                    let i = $("#index_count").text()
                    admin_index.innerHTML +=
                        '<div id="index_item' + i + '" class="mdui-panel-item">' +
                        '                    <div class="mdui-panel-item-header">' +
                        '                        <div id="index_title_old' + i + '" class="mdui-panel-item-title">' + index_name.val() + '</div>' +
                        '                        <i class="mdui-panel-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>' +
                        '                    </div>' +
                        '                    <div class="mdui-panel-item-body">' +
                        '                        <div class="mdui-textfield">' +
                        '                          <label>' +
                        '                                <input id="index_title' + i + '" class="mdui-textfield-input" type="text" value="' + index_name.val() + '"/>' +
                        '                            </label><br>' +
                        '                        </div>' +
                        '                        <div class="mdui-panel-item-actions">' +
                        '                            <button class="mdui-btn mdui-ripple" mdui-panel-item-close>取消</button>' +
                        '                            <button class="mdui-btn mdui-ripple" onclick="delete_index(' + i + ')" mdui-panel>删除</button>' +
                        '                            <button class="mdui-btn mdui-ripple" onclick="update_index(' + i + ')">修改</button>' +
                        '                        </div>' +
                        '                    </div>' +
                        '                </div>';
                    index_name.val("")
                    $("#button_cancel_add_index").click()
                }
            },
            error: function () {
                mdui.alert("未知错误", "提醒")
            }
        })
    }

    function delete_index(i) {
        let index_name = $("#index_title_old" + i)
        mdui.confirm('是否确认删除？', '提醒', function () {
            $.ajax({
                url: "api.php",
                type: "post",
                dataType: "json",
                data: {
                    'function': 'delete_index',
                    'index_name': index_name.text()
                },
                success: function (result) {
                    if (result.data.isSucceed === 'true') {
                        var obj = document.getElementById("index_item" + i);
                        obj.innerHTML = "";
                        var parentObj = obj.parentNode;
                        parentObj.removeChild(obj);
                    } else {
                        mdui.alert("您未登录", "警告")
                    }
                },
                error: function () {
                    mdui.alert("未知错误", "提醒")
                }
            })
        });
    }

    function logout() {
        mdui.confirm('是否确定退出？', '提醒', function () {
            $.ajax({
                type: "POST",
                url: "api.php",
                dataType: "json",
                data: {
                    "function": "logout"
                },
                success: function () {
                    document.cookie = "TokenID" + "=" + "" + "; " + "-1";
                    document.cookie = "Token" + "=" + "" + "; " + "-1";
                    window.location = "/";
                }
            });
        });
    }
</script>
</html>